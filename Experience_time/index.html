<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>羽之國 S3 經驗時間計算器</title>
<style>
:root {
  --main-bg: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
  --card-bg: rgba(255, 255, 255, 0.78);
  --accent: #2563eb;
  --accent-light: #3b82f6;
  --text-dark: #1e3a8a;
}
body {
  font-family: "Microsoft JhengHei", sans-serif;
  background: var(--main-bg);
  min-height: 100vh;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  color: var(--text-dark);
}
main.card {
  backdrop-filter: blur(14px) saturate(160%);
  background: var(--card-bg);
  border-radius: 20px;
  box-shadow: 0 10px 28px rgba(0,0,0,0.15);
  margin: 16px;
  padding: 22px 18px 26px 18px;
  max-width: 480px;
  width: calc(100% - 32px);
  animation: fadeIn 0.8s ease;
  box-sizing: border-box;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
h2 {
  text-align: center;
  font-size: 1.6em;
  color: var(--accent);
  margin-bottom: 6px;
}
small {
  display: block;
  text-align: center;
  color: #475569;
  margin-bottom: 14px;
}
form {
  display: flex;
  flex-direction: column;
  gap: 14px;
}
label {
  font-weight: bold;
  font-size: 0.95em;
  margin-bottom: 4px;
  display: block;
}
input {
  width: 100%;
  box-sizing: border-box;
  padding: 10px 12px;
  border: 1px solid #93c5fd;
  border-radius: 10px;
  font-size: 1em;
  background: rgba(255,255,255,0.88);
  transition: 0.2s;
}
input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 5px rgba(59,130,246,0.5);
}
button {
  padding: 14px;
  border: none;
  border-radius: 12px;
  background: var(--accent-light);
  color: #fff;
  font-size: 1.1em;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  width: 100%;
}
button:hover {
  background: var(--accent);
  transform: translateY(-1px);
}
.results {
  margin-top: 22px;
  padding: 16px 14px;
  border-radius: 14px;
  background: rgba(255,255,255,0.7);
  box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
  line-height: 1.7;
  animation: fadeIn 0.5s ease;
  word-wrap: break-word;
}
#countdown, #acceleratedCountdown {
  font-weight: bold;
  color: var(--accent);
}
footer {
  text-align: center;
  margin-top: 22px;
  font-size: 0.85em;
  color: #475569;
}
.unit-label {
  font-size: 0.85em;
  color: #64748b;
  margin-left: 6px;
}
.divider {
  text-align: center;
  margin: 14px 0;
  color: #93c5fd;
  font-weight: bold;
}
.flex-row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.flex-col {
  flex: 1 1 45%;
}
@media (max-width:600px){
  main.card{margin:10px;padding:18px;}
  h2{font-size:1.3em;}
  button{font-size:1em;padding:12px;}
  input{font-size:0.95em;}
}
</style>
</head>
<body>
<main class="card">
  <h2>羽之國 S3 經驗時間計算器</h2>
  <small>Ver 1.0.1 - 美化升級版</small>

  <form id="expForm">
    <label>現在等級（Lv）</label>
    <input id="currentLevel" type="number" min="1" placeholder="例如：98">

    <label>現有經驗（Exp，萬）<span class="unit-label">輸入 5 代表 50000</span></label>
    <input id="currentExp" type="number" min="0" step="0.1" placeholder="例如：5">

    <label>目標等級（Lv）</label>
    <input id="targetLevel" type="number" min="1" placeholder="例如：100">

    <label>每小時經驗（EXP/h）</label>
    <input id="expPerHour" type="number" min="1" placeholder="例如：20000">

    <div class="divider">加速項目</div>
    <div class="flex-row">
      <div class="flex-col">
        <label>日常加速次數</label>
        <input id="dailyBoosts" type="number" min="0" value="0">
      </div>
      <div class="flex-col">
        <label>石頭加速次數</label>
        <input id="stoneBoosts" type="number" min="0" value="0">
      </div>
    </div>

    <button type="submit">✨ 開始計算 ✨</button>
  </form>

  <section id="results" class="results" hidden>
    <p id="remainingExp"></p>
    <p id="neededSeconds"></p>
    <p id="nowTime"></p>
    <p id="finishTime"></p>
    <p id="acceleratedTime"></p>
    <p id="countdown"></p>
    <p id="acceleratedCountdown"></p>
  </section>

  <footer>© 小咕・羽之國 Ver 1.0.1 - 美化升級版</footer>
</main>

<script>
// ====== 經驗表 ======
const EXP_TABLE = new Map(
`LEVEL,EXP
1,80
2,90
3,90
4,90
5,90
6,90
7,90
8,90
9,100
10,350
11,355
12,360
13,370
14,375
15,390
16,400
17,450
18,500
19,500
20,1483
21,1844
22,1865
23,1916
24,2043
25,2067
26,2169
27,2437
28,2536
29,2860
30,2995
31,3607
32,3794
33,3876
34,3996
35,4261
36,4289
37,4510
38,4928
39,5086
40,17203
41,19189
42,21484
43,21509
44,23052
45,24627
46,25480
47,26852
48,29068
49,32008
50,33168
51,33332
52,34095
53,35628
54,35929
55,37680
56,38331
57,38878
58,39016
59,41731
60,43128
61,45042
62,45412
63,47152
64,47282
65,47340
66,50487
67,53076
68,54257
69,54405
70,197114
71,310414
72,330204
73,334735
74,348791
75,360389
76,360701
77,362826
78,378632
79,379059
80,408765
81,440713
82,464670
83,467234
84,477970
85,484690
86,509874
87,513879
88,527583
89,532378
90,583801
91,612907
92,643189
93,644274
94,670957
95,678226
96,706678
97,712891
98,749807
99,751452
100,2904398
101,3027527
102,3032011
103,3117883
104,3191855
105,3220513
106,3258763
107,3346658
108,3389858
109,3548753
110,3631694
111,3771824
112,3796167
113,3866624
114,3924404
115,4029348
116,4101565
117,4245434
118,4245686
119,4514881
120,4566377
121,4752888
122,4866448
123,5012377
124,5016341
125,5178619
126,5229563
127,5423881
128,5459728
129,6335318
130,22859655
131,23541185
132,23587156
133,24290510
134,24337860
135,25112507
136,25161277
137,25962089
138,26062556
139,26920314
140,27780149
141,28608441
142,28773140
143,29687769
144,29800863
145,30864506
146,30980992
147,32025290
148,32205262
149,33270698
150,34387276
151,35609150
152,35871344
153,37143639
154,37211154
155,38460179
156,38529719
157,39822474
158,40037353
159,43248083
160,44969859
161,48762878
162,52604320
163,56396556
164,60225668
165,63980989
166,67994521
167,71934262
168,76039985
169,80194876
170,80600630
171,81009637
172,81415408
173,81685922
174,81821179
175,82226950
176,82632720
177,82903234
178,83309005
179,83714776
180,83985290
181,84388130
182,84658635
183,84929139
184,85334896
185,85605400
186,85875905
187,86281661
188,86552166
189,86822670
190,86957923
191,87237117
192,87507648
193,87913445
194,88183977
195,88319242
196,88725039
197,88995571
198,89130837
199,89536634
200,89807165
201,90068724
202,90339228
203,90609732
204,90880237
205,91150741
206,91421246
207,91691750
208,91962255
209,92232759
210,92503264
211,92777498
212,93048013
213,93318529
214,93589044
215,93859559
216,94130075
217,94400590
218,94671105
219,94941621
220,95212136
221,95484480
222,95619740
223,95755001
224,96025521
225,96296042
226,96566562
227,96837083
228,97107603
229,97378124
230,97648644
231,97782337
232,98052853
233,98323369
234,98593885
235,98864402
236,99134918
237,99405434
238,99675950
239,99946466
240,100216982
241,100486625
242,100757139
243,101027652
244,101298166
245,101568680
246,101839194
247,102109708
248,102380221
249,102650735
250,102921249
251,103174919
252,103445389
253,103715858
254,103715858
255,103715858
256,103715858
257,103715858
258,103715858
259,103715858
260,103715858
261,103715858
262,103715858
263,103715858
264,103715858
265,103715858
266,103715858
267,103715858
268,103715858
269,103715858
270,103715858
271,103715858
272,103715858
273,103715858
274,103715858
275,103715858
276,103715858
277,103715858
278,103715858
279,103715858
280,103715858
281,103715858
282,103715858
283,103715858
284,103715858
285,103715858
286,103715858
287,103715858
288,103715858
289,103715858
290,103715858
291,103715858
292,103715858
293,103715858
294,103715858
295,103715858
296,103715858
297,103715858
298,103715858
299,103715858
300,103715858
`
.trim().split(/\r?\n/).slice(1)
.map(line=>{
  const [lv,exp]=line.split(',').map(Number);
  return [lv,exp];
})
);

// ====== 前綴和 ======
const prefixSum = (() => {
  const levels = [...EXP_TABLE.keys()];
  const maxLv = Math.max(...levels);
  const p = [0];
  for(let i=1;i<=maxLv;i++){
    const exp = EXP_TABLE.get(i) || 0;
    p[i] = p[i-1] + exp;
  }
  return p;
})();

const fmtNum = n => new Intl.NumberFormat().format(n);
const fmtDur = s => {
  if (s <= 0) return "0秒";
  const d = Math.floor(s/86400); s %= 86400;
  const h = Math.floor(s/3600); s %= 3600;
  const m = Math.floor(s/60); s %= 60;
  return `${d}天 ${h}時 ${m}分 ${s}秒`;
};
const remainExp = (curLv,curExp,tgtLv)=> prefixSum[tgtLv]-prefixSum[curLv]-curExp;

// ====== 倒數 ======
let timer = 0;
function startCountdown(finishAt,accFinishAt){
  const cd=document.getElementById("countdown");
  const acc=document.getElementById("acceleratedCountdown");
  clearInterval(timer);
  timer=setInterval(()=>{
    const now=Date.now();
    const r=Math.max(0,Math.floor((finishAt-now)/1000));
    const a=Math.max(0,Math.floor((accFinishAt-now)/1000));
    cd.textContent=r<=0?"倒計時：已完成！":`倒計時：${fmtDur(r)}`;
    acc.textContent=a<=0?"加速倒計時：已完成！":`加速倒計時：${fmtDur(a)}`;
    if(r<=0 && a<=0) clearInterval(timer);
  },1000);
}

// ====== 主邏輯 ======
document.getElementById("expForm").addEventListener("submit",e=>{
  e.preventDefault();
  const curLv=+document.getElementById("currentLevel").value||0;
  const curExp=(+document.getElementById("currentExp").value||0)*10000;
  const tgtLv=+document.getElementById("targetLevel").value||0;
  const eph=+document.getElementById("expPerHour").value||0;
  const boosts=(+document.getElementById("dailyBoosts").value||0)+(+document.getElementById("stoneBoosts").value||0);

  if(curLv<=0 || tgtLv<=curLv || eph<=0){ alert("請輸入正確的等級與經驗值"); return; }

  const remain=remainExp(curLv,curExp,tgtLv);
  if(!isFinite(remain) || remain<=0){ alert("已達目標等級或經驗不足。"); return; }

  const secs=remain/(eph/3600);
  const now=Date.now();
  const finishAt=now+secs*1000;
  const accFinishAt=finishAt - boosts*7200*1000;

  const res=document.getElementById("results");
  res.hidden=false;
  document.getElementById("remainingExp").textContent=`剩餘經驗：${fmtNum(remain)}`;
  document.getElementById("neededSeconds").textContent=`預計耗時：${fmtDur(Math.floor(secs))}`;
  document.getElementById("nowTime").textContent=`現在時間：${new Date(now).toLocaleString()}`;
  document.getElementById("finishTime").textContent=`完成時間：${new Date(finishAt).toLocaleString()}`;
  document.getElementById("acceleratedTime").textContent=`加速完成：${new Date(accFinishAt).toLocaleString()}`;
  startCountdown(finishAt,accFinishAt);
});
</script>
</body>
</html>
