<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è²·è£å‚™è³£ç¥é‘„çŸ³ç²åˆ©è¨ˆç®—</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#111;
    color:white;
    margin:0;
    padding:15px;
}

h2{text-align:center;}

.container{
    max-width:520px;
    margin:auto;
}

.control{
    display:flex;
    justify-content:space-between;
    margin-bottom:15px;
}

.control input{
    width:100px;
    padding:6px;
    font-size:16px;
    text-align:center;
}

.card{
    background:#222;
    padding:15px;
    margin-top:15px;
    border-radius:12px;
}

.row{
    display:flex;
    justify-content:space-between;
    margin:6px 0;
    font-size:14px;
}

input{
    background:#333;
    color:white;
    border:1px solid #555;
    border-radius:6px;
    padding:5px;
    width:110px;
    text-align:center;
}

.profit{font-weight:bold;}
.green{color:#4dff88;}
.red{color:#ff4d4d;}
.gray{color:#aaa;}
.highlight{border:2px solid gold;}

.summary{
    background:#333;
    padding:15px;
    margin-top:20px;
    border-radius:12px;
    font-size:14px;
}

button{
    margin-top:15px;
    width:100%;
    padding:10px;
    background:#ff4444;
    color:white;
    border:none;
    border-radius:8px;
    font-size:16px;
}
</style>
</head>
<body>

<div class="container">

<h2>ğŸ“± è²·è£å‚™è³£ç¥é‘„çŸ³ç²åˆ©è¨ˆç®—</h2>

<div class="control">
    <div>
        ç¥é‘„çŸ³å–®åƒ¹<br>
        <input type="number" id="price" min="0" step="1">
    </div>
    <div>
        ç¨…ç‡(%)<br>
        <input type="number" id="tax" min="0" max="100" step="1">
    </div>
</div>

<div id="cards"></div>

<div class="summary">
    <div>ç¸½æŠ•å…¥ï¼š<span id="totalBuy"></span></div>
    <div>ç¸½å¯¦æ‹¿ï¼š<span id="totalReal"></span></div>
    <div>ç¸½æ·¨åˆ©ï¼š<span id="totalProfit" class="profit"></span></div>
</div>

<button onclick="resetData()">æ¸…ç©ºè³‡æ–™</button>

</div>

<script>
const items = [
    {name:"é‡‘è£å‚™", fragmentPerEquip:100, defaultBuy:400},
    {name:"ç´…è£å‚™", fragmentPerEquip:150, defaultBuy:600},
    {name:"ç¥å°è£å‚™", fragmentPerEquip:500, defaultBuy:2000}
];

// å»ºç«‹å¡ç‰‡
function createCards(){
    const container = document.getElementById("cards");
    items.forEach((item,index)=>{
        container.innerHTML += `
        <div class="card" id="card${index}">
            <h3>${item.name}</h3>

            <div class="row">
                <span>å–®ä»¶æˆæœ¬</span>
                <input type="number" id="unit${index}" min="0" step="1">
            </div>

            <div class="row">
                <span>è£å‚™æ•¸é‡</span>
                <input type="number" id="equip${index}" min="0" step="1">
            </div>

            <div class="row">
                <span>ç¸½æˆæœ¬</span>
                <span id="totalCost${index}" class="gray"></span>
            </div>

            <div class="row">
                <span>ç¢ç‰‡æ•¸é‡</span>
                <span id="fragments${index}" class="gray"></span>
            </div>

            <div class="row">
                <span>å¯¦éš›æ‹¿åˆ°</span>
                <span id="real${index}"></span>
            </div>

            <div class="row">
                <span>æ·¨åˆ©</span>
                <span id="profit${index}" class="profit"></span>
            </div>

            <div class="row">
                <span>ROI %</span>
                <span id="roi${index}"></span>
            </div>
        </div>
        `;
    });
}

// è¨ˆç®—
function calculate(){
    // å¼·åˆ¶å¡«æ•¸å­—
    let price = parseFloat(priceInput.value);
    if(isNaN(price) || price < 0) price = 0;
    priceInput.value = price;

    let taxRate = parseFloat(taxInput.value);
    if(isNaN(taxRate) || taxRate < 0) taxRate = 0;
    if(taxRate > 100) taxRate = 100;
    taxInput.value = taxRate;
    taxRate = taxRate / 100;

    let totalBuy = 0;
    let totalReal = 0;
    let bestProfit = -Infinity;
    let bestIndex = -1;

    items.forEach((item,index)=>{
        let unit = parseFloat(document.getElementById("unit"+index).value);
        if(isNaN(unit) || unit < 0) unit = item.defaultBuy;
        document.getElementById("unit"+index).value = unit;

        let equip = parseFloat(document.getElementById("equip"+index).value);
        if(isNaN(equip) || equip < 0) equip = 1;
        document.getElementById("equip"+index).value = equip;

        const totalCost = unit * equip;
        const fragments = equip * item.fragmentPerEquip;
        const sale = fragments * price;
        const real = Math.floor(sale * (1 - taxRate));
        const profit = real - totalCost;
        const roi = totalCost > 0 ? ((profit / totalCost) * 100).toFixed(1) : 0;

        document.getElementById("totalCost"+index).innerText = totalCost;
        document.getElementById("fragments"+index).innerText = fragments;
        document.getElementById("real"+index).innerText = real;

        const profitEl = document.getElementById("profit"+index);
        profitEl.innerText = profit;
        profitEl.className = "profit " + (profit>=0 ? "green":"red");

        document.getElementById("roi"+index).innerText = roi + "%";

        document.getElementById("card"+index).classList.remove("highlight");

        if(profit > bestProfit){
            bestProfit = profit;
            bestIndex = index;
        }

        totalBuy += totalCost;
        totalReal += real;
    });

    if(bestIndex >= 0){
        document.getElementById("card"+bestIndex).classList.add("highlight");
    }

    const totalProfit = totalReal - totalBuy;
    document.getElementById("totalBuy").innerText = totalBuy;
    document.getElementById("totalReal").innerText = totalReal;
    const totalProfitEl = document.getElementById("totalProfit");
    totalProfitEl.innerText = totalProfit;
    totalProfitEl.className = "profit " + (totalProfit>=0 ? "green":"red");

    saveData();
}

// å„²å­˜èˆ‡è®€å–
function saveData(){
    const data = {price:priceInput.value,tax:taxInput.value,items:[]};
    items.forEach((item,index)=>{
        data.items.push({
            unit:document.getElementById("unit"+index).value,
            equip:document.getElementById("equip"+index).value
        });
    });
    localStorage.setItem("forgePanelPro",JSON.stringify(data));
}

function loadData(){
    const saved = JSON.parse(localStorage.getItem("forgePanelPro"));
    if(saved){
        priceInput.value = saved.price;
        taxInput.value = saved.tax;
        saved.items.forEach((item,index)=>{
            document.getElementById("unit"+index).value = item.unit;
            document.getElementById("equip"+index).value = item.equip;
        });
    }else{
        priceInput.value = 5;
        taxInput.value = 20;
        items.forEach((item,index)=>{
            document.getElementById("unit"+index).value = item.defaultBuy;
            document.getElementById("equip"+index).value = 1;
        });
    }
}

// æ¸…ç©º
function resetData(){
    localStorage.removeItem("forgePanelPro");
    location.reload();
}

createCards();

const priceInput = document.getElementById("price");
const taxInput = document.getElementById("tax");

loadData();
calculate();

document.addEventListener("input", calculate);
</script>

</body>
</html>
