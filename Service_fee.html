<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
<title>手續費計算</title>
<style>
<link rel="stylesheet" href="static/css/style_time.css">
</style>
</head>

<body class="light">
<div class="card">
<h2>手續費計算</h2>

<!-- 交易行 / 拍賣行 -->
<div class="toggle-buttons">
  <button id="market" class="active" onclick="setMarket('market')">交易行</button>
  <button id="auction" onclick="setMarket('auction')">拍賣行</button>
</div>

<label id="priceLabel">單價（元）：</label>
<input id="price" readonly onclick="setInput('price')">

<label id="quantityLabel">數量（個）：</label>
<input id="quantity" readonly onclick="setInput('quantity')">

<!-- 交易行數量切換按鈕 -->
<div class="toggle-buttons" id="qtyToggle" style="margin-top:10px;">
  <button id="btn1" class="active" onclick="setQtyMode(1)">1 個</button>
  <button id="btn10" onclick="setQtyMode(10)">1 組 (10個)</button>
</div>

<label>手續費%：</label>
<input id="feeRate" readonly onclick="setInput('feeRate')">

<!-- 虛擬鍵盤 -->
<div class="keyboard">
  <div class="key" onclick="press('1')">1</div>
  <div class="key" onclick="press('2')">2</div>
  <div class="key" onclick="press('3')">3</div>
  <div class="key" onclick="press('del')">⌫</div>

  <div class="key" onclick="press('4')">4</div>
  <div class="key" onclick="press('5')">5</div>
  <div class="key" onclick="press('6')">6</div>
  <div class="key" onclick="press('clear')">清空</div>

  <div class="key" onclick="press('7')">7</div>
  <div class="key" onclick="press('8')">8</div>
  <div class="key" onclick="press('9')">9</div>
  <div class="key" onclick="press('0')">0</div>
</div>

<!-- 結果 -->
<div class="result-box">
  <div class="result-line"><span class="label">總金額：</span><span id="showTotal" class="value">0 元</span></div>
  <div class="result-line"><span class="label">手續費金額：</span><span id="showFee" class="value">0 元</span></div>
  <div class="result-line"><span class="label">實收金額：</span><span id="showNet" class="value">0 元</span></div>
</div>

<button class="theme-btn" onclick="toggleTheme()">切換暗色 / 亮色模式</button>
</div>

<script>
let activeInput = null;
let qtyMode = 1;
let marketMode = 'market';

function setInput(id){ activeInput=document.getElementById(id); }

function updatePriceLabel(){
  const label = document.getElementById('priceLabel');
  if(marketMode==='auction'){
    label.textContent = '單價（元，單個價格）：';
  } else {
    label.textContent = qtyMode===1 ? '單價（元，單個價格）：' : '單價（元，每組價格）：';
  }
}

function updateQuantityLabel(){
  const label = document.getElementById('quantityLabel');
  label.textContent = (qtyMode===1) ? '數量（個）：' : '數量（組）：';
}

function setMarket(m){
  marketMode = m;
  document.getElementById("market").classList.toggle("active", m==='market');
  document.getElementById("auction").classList.toggle("active", m==='auction');

  document.getElementById("qtyToggle").style.display = (m==='market') ? 'flex':'none';
  qtyMode = 1;
  setQtyMode(qtyMode);
  updatePriceLabel();
  calculate();
  saveData();
}

function setQtyMode(m){
  qtyMode = m;
  document.getElementById("btn1").classList.toggle("active", m===1);
  document.getElementById("btn10").classList.toggle("active", m===10);

  // 切換模式時單價與數量歸零，但手續費不變
  document.getElementById("price").value = '';
  document.getElementById("quantity").value = '';

  updatePriceLabel();
  updateQuantityLabel();
  calculate();
  saveData();
}

function press(key){
  if(!activeInput) return;
  if(key==='del') activeInput.value = activeInput.value.slice(0,-1);
  else if(key==='clear') activeInput.value = '';
  else activeInput.value += key;

  calculate();
  saveData();
}

function calculate(){
  const priceInput = parseFloat(document.getElementById("price").value) || 0;
  const quantity = parseFloat(document.getElementById("quantity").value) || 0;
  const feeRate = parseFloat(document.getElementById("feeRate").value) || 0;

  const unitPrice = (qtyMode===1) ? priceInput : priceInput/10;
  const realQty = (marketMode==='market') ? quantity*qtyMode : quantity;

  const total = unitPrice * realQty;
  const fee = total * (feeRate/100);
  const net = total - fee;

  document.getElementById("showTotal").textContent = total.toFixed(2)+' 元';
  document.getElementById("showFee").textContent = fee.toFixed(2)+' 元';
  document.getElementById("showNet").textContent = net.toFixed(2)+' 元';
}

// 儲存資料
function saveData(){
  localStorage.setItem("price", document.getElementById("price").value);
  localStorage.setItem("quantity", document.getElementById("quantity").value);
  localStorage.setItem("feeRate", document.getElementById("feeRate").value);
  localStorage.setItem("marketMode", marketMode);
  localStorage.setItem("qtyMode", qtyMode);
  localStorage.setItem("theme", document.body.classList.contains("dark") ? 'dark':'light');
}

// 載入資料
function loadData(){
  document.getElementById("price").value = localStorage.getItem("price") || '';
  document.getElementById("quantity").value = localStorage.getItem("quantity") || '';
  document.getElementById("feeRate").value = localStorage.getItem("feeRate") || '';
  const savedMarket = localStorage.getItem("marketMode") || 'market';
  const savedQty = parseInt(localStorage.getItem("qtyMode")) || 1;
  const savedTheme = localStorage.getItem("theme") || 'light';

  setMarket(savedMarket);
  setQtyMode(savedQty);
  if(savedTheme==='dark') document.body.classList.add('dark');

  updatePriceLabel();
  calculate();
}

// 初始化
loadData();

// 暗色模式
function toggleTheme(){
  document.body.classList.toggle("dark");
  saveData();
}
</script>

<div style="max-width:500px;margin:15px auto;text-align:center;font-size:12px;color:#555;line-height:1.4;">
  製作@小咕  版本: 1.0  日期: 2025/11/25<br>
  <a href="mailto:totpure@duck.com" style="color: black; font-weight: bold; text-decoration: underline;">
    問題回饋
</body>
</html>
